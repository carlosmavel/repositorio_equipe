{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="container-fluid px-5 mt-3">
  <h3>{{ title }}</h3>
  <div class="row">
    {% for key in order %}
      {% if show_draft or key != 'rascunho' %}
      <div class="col-md-2">
        <h5>{{ labels[key] }}</h5>
        {% if columns[key] %}
          {% for os in columns[key] %}
          <div class="card mb-2 os-card {% if os.prioridade %}prioridade-{{ os.prioridade }}{% endif %}" data-os="{{ os.codigo }}" style="cursor:pointer;">
            <div class="card-body p-2">
              <div><strong>Código OS:</strong> {{ os.codigo }}</div>
              <div class="fw-bold"><strong>Título:</strong> {{ os.titulo }}</div>
              {% if os.prioridade %}<small class="text-muted">Prioridade: {{ os.prioridade }}</small>{% endif %}
            </div>
          </div>
          {% endfor %}
        {% else %}
          <p class="text-muted small">Sem OS</p>
        {% endif %}
      </div>
      {% endif %}
    {% endfor %}
  </div>
</div>
<div class="modal fade" id="osModal" tabindex="-1" aria-hidden="true"></div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.os-card').forEach(function (card) {
      card.addEventListener('click', function () {
        const osId = this.dataset.os;
        fetch(`/os/${osId}/modal`)
          .then(resp => resp.text())
          .then(html => {
            const modalEl = document.getElementById('osModal');
            modalEl.innerHTML = html;
            const modal = new bootstrap.Modal(modalEl);
            modal.show();
          });
      });
    });
  });
</script>
{% endblock %}
