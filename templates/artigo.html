{% extends "base.html" %}

{% block title %}{{ artigo.titulo }}{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-md-8 mx-auto">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3>{{ artigo.titulo }}</h3>
          <p class="text-muted">
            Autor: {{ artigo.author.nome_completo or artigo.author.username }} |
            Criado em: {{ artigo.created_at.strftime('%d/%m/%Y %H:%M') }}
          </p>
          <hr>
          <div>
            {{ artigo.texto.replace('\n','<br>')|safe }}
          </div>

          {% if arquivos %}
            <hr>
            <h5>Anexos</h5>
            <ul>
              {% for arquivo in arquivos %}
                <li>
                  <a href="{{ url_for('uploaded_file', filename=arquivo) }}" target="_blank">
                    <i class="bi bi-file-earmark"></i> {{ arquivo }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">Sem anexos.</p>
          {% endif %}

          <p class="text-muted mt-3"><strong>Status:</strong> {{ artigo.status|capitalize }}</p>

          {% if artigo.review_comment %}
            <hr>
            <h5>Comentário do Revisor</h5>
            <div class="card border-info mb-3">
              <div class="card-body">
                {{ artigo.review_comment.replace('\n','<br>')|safe }}
              </div>
            </div>
          {% endif %}

          {% if session.role in ['colaborador','editor','admin'] and artigo.status in ['pendente','em_ajuste','rejeitado'] %}
            <hr>
            <h5>Editar Artigo</h5>
            <form method="POST" enctype="multipart/form-data">
              <div class="mb-3">
                <label class="form-label"><i class="bi bi-fonts" title="Título"></i></label>
                <input type="text" name="titulo" class="form-control" value="{{ artigo.titulo }}" required>
              </div>
              <div class="mb-3">
                <label class="form-label"><i class="bi bi-text-paragraph" title="Texto"></i></label>
                <textarea name="texto" class="form-control" rows="5" required>{{ artigo.texto }}</textarea>
              </div>
              <div class="mb-3">
                <label class="form-label"><i class="bi bi-paperclip" title="Anexar Arquivos"></i></label>
                <input type="file" name="files" class="form-control" multiple>
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-pencil-square"></i> Salvar
              </button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}