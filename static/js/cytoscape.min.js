(function(){
  function Cytoscape(options){
    const container = options.container;
    const elements = options.elements || [];
    container.innerHTML = '';
    const svgNS = 'http://www.w3.org/2000/svg';
    const svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('width','100%');
    svg.setAttribute('height','100%');
    container.appendChild(svg);
    const nodes = {};
    const positions = {};
    const step = 100;
    let x = 50, y = 50, count = 0;
    const nodeElements = elements.filter(e=>e.data && e.data.id && !e.data.source && !e.data.target);
    const perRow = Math.ceil(Math.sqrt(nodeElements.length));
    nodeElements.forEach(el=>{
      const d = el.data || {};
      positions[d.id] = {x,y};
      const circle = document.createElementNS(svgNS,'circle');
      circle.setAttribute('cx',x);
      circle.setAttribute('cy',y);
      circle.setAttribute('r',20);
      circle.setAttribute('fill',d.color || '#999');
      svg.appendChild(circle);
      const text = document.createElementNS(svgNS,'text');
      text.setAttribute('x',x);
      text.setAttribute('y',y+4);
      text.setAttribute('text-anchor','middle');
      text.setAttribute('font-size','10');
      text.textContent = d.label || d.id;
      svg.appendChild(text);
      nodes[d.id] = circle;
      count++;
      x += step;
      if(count % perRow === 0){ x = 50; y += step; }
    });
    elements.forEach(el=>{
      const d = el.data || {};
      if(d.source && d.target){
        const s = positions[d.source];
        const t = positions[d.target];
        if(s && t){
          const line = document.createElementNS(svgNS,'line');
          line.setAttribute('x1',s.x);
          line.setAttribute('y1',s.y);
          line.setAttribute('x2',t.x);
          line.setAttribute('y2',t.y);
          line.setAttribute('stroke','#333');
          svg.insertBefore(line, svg.firstChild);
        }
      }
    });
    return {
      on: function(){},
      style: function(){},
      nodes: function(){ return []; }
    };
  }
  window.cytoscape = function(opts){ return Cytoscape(opts); };
})();
